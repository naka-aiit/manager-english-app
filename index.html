<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Manager English v3.0 Swipe</title>
<style>
  /* === å…¨ä½“ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ === */
  body {
    background-color: #000;
    color: white;
    font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    margin: 0;
    display: flex; justify-content: center; align-items: center;
    height: 100vh; height: 100dvh; 
    overflow: hidden; touch-action: none; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç„¡åŠ¹åŒ– */
  }

  /* === ã‚¹ãƒãƒ›ç”»é¢æ  === */
  #appScreen {
    width: 100%; max-width: 400px; height: 100%;
    background: radial-gradient(circle at center, #1a1a2e 0%, #000 100%);
    position: relative; overflow: hidden;
    display: flex; flex-direction: column;
  }

  /* === ã‚¹ãƒ¯ã‚¤ãƒ—ç”¨ã‚³ãƒ³ãƒ†ãƒŠ === */
  /* å•é¡ŒãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚¨ãƒªã‚¢ã€‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§å‹•ã */
  #cardContainer {
    flex: 1; position: relative; width: 100%; height: 100%;
    overflow: hidden;
  }

  .quiz-card {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    padding: 20px; box-sizing: border-box;
    transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1), opacity 0.4s;
    background: transparent; /* èƒŒæ™¯ã¯è¦ªã«ä»»ã›ã‚‹ */
  }

  /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¯ãƒ©ã‚¹ */
  .card-active { transform: translateY(0); opacity: 1; z-index: 10; }
  .card-prev   { transform: translateY(-100%); opacity: 0; z-index: 5; } /* ä¸Šã«æ¶ˆãˆãŸ */
  .card-next   { transform: translateY(100%); opacity: 0; z-index: 5; } /* ä¸‹ã§å¾…æ©Ÿ */

  /* === FEVERæ¼”å‡º === */
  #feverEffect {
    position: absolute; top:0; left:0; width:100%; height:100%;
    background: linear-gradient(45deg, rgba(255,0,150,0.2), rgba(0,242,234,0.2));
    opacity: 0; pointer-events: none; z-index: 1; transition: opacity 0.3s;
    mix-blend-mode: screen;
  }

  /* === ã‚¿ã‚¤ãƒ ãƒãƒ¼ === */
  #timerContainer {
    width: 100%; height: 6px; background: rgba(255,255,255,0.1); 
    position: absolute; top: 0; left: 0; z-index: 100;
  }
  #timerBar {
    width: 0%; height: 100%; background: #00f2ea; 
    box-shadow: 0 0 10px #00f2ea; transition: width 0.1s linear;
  }

  /* === ãƒ˜ãƒƒãƒ€ãƒ¼ === */
  .header {
    position: absolute; top: 0; left: 0; width: 100%;
    padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
    z-index: 50; box-sizing: border-box;
    background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
  }
  .home-btn { font-size: 1.5rem; cursor: pointer; filter: drop-shadow(0 0 5px #fff); }
  .level-box { font-weight: 900; font-size: 1rem; color: #fff; text-shadow: 0 0 10px #00f2ea; font-style: italic; }

  /* === ã‚³ãƒ³ãƒœè¡¨ç¤º === */
  #comboContainer {
    position: absolute; top: 15%; width: 100%; text-align: center;
    pointer-events: none; z-index: 20;
    opacity: 0; transform: scale(0.5);
    transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
  #comboNum { font-size: 4rem; font-weight: 900; color: #ff0055; text-shadow: 2px 2px 0 #fff, 0 0 20px #ff0055; }
  #comboLabel { font-size: 1.2rem; font-weight: bold; color: #fff; letter-spacing: 5px; }

  /* === ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ã‚¶ã‚¤ãƒ³ === */
  .word-title {
    font-size: 2.8rem; font-weight: 800; margin: 0 0 15px 0; text-align: center;
    text-shadow: 0 4px 10px rgba(0,0,0,0.5); letter-spacing: -1px;
  }
  .question-box {
    font-size: 1.2rem; font-weight: 500; line-height: 1.6; text-align: center;
    margin-bottom: 30px; text-shadow: 0 2px 4px rgba(0,0,0,0.8);
    background: rgba(0,0,0,0.3); padding: 15px; border-radius: 15px;
    backdrop-filter: blur(4px); width: 90%;
  }

  /* === ãƒœã‚¿ãƒ³ç¾¤ === */
  .btn-group { display: flex; flex-direction: column; gap: 15px; width: 100%; max-width: 320px; }
  .btn {
    background: rgba(255,255,255,0.1); 
    border: 1px solid rgba(255,255,255,0.2); 
    color: white;
    padding: 16px; border-radius: 50px; /* ä¸¸ã¿ã‚’å¼·ãã—ã¦TikTokãƒœã‚¿ãƒ³é¢¨ã« */
    font-size: 1.0rem; font-weight: bold;
    cursor: pointer; transition: transform 0.1s, background 0.2s;
    text-align: center; position: relative; overflow: hidden;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  .btn:active { transform: scale(0.95); background: rgba(255,255,255,0.2); }

  /* === è§£èª¬ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆä¸‹ã‹ã‚‰å‡ºã‚‹ï¼‰ === */
  #expOverlay {
    position: absolute; bottom: 0; left: 0; width: 100%; height: auto; max-height: 70%;
    background: rgba(15,15,20,0.95);
    border-top: 2px solid #00f2ea;
    border-radius: 20px 20px 0 0;
    transform: translateY(110%);
    transition: transform 0.3s cubic-bezier(0.19, 1, 0.22, 1);
    display: flex; flex-direction: column; padding: 25px; box-sizing: border-box; 
    z-index: 400; box-shadow: 0 -10px 40px rgba(0,0,0,0.8);
  }
  #expOverlay.show { transform: translateY(0); }
  
  .exp-result { font-size: 2.2rem; font-weight: 900; margin-bottom: 10px; text-align: center; letter-spacing: 2px; }
  .exp-content-body { overflow-y: auto; margin-bottom: 15px; }
  .exp-msg { font-size: 1rem; line-height: 1.6; color: #ddd; margin-bottom: 10px; }
  .swipe-hint {
    text-align: center; color: #888; font-size: 0.8rem; margin-top: 10px;
    animation: bounce 2s infinite;
  }
  @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

  /* === ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ === */
  #startScreen {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
    background: #000; z-index: 500;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
  }
  .title-logo {
    font-size: 3.5rem; font-weight: 900; color: #fff; font-style: italic;
    letter-spacing: -2px; margin-bottom: 5px;
    background: linear-gradient(to right, #00f2ea, #ff0055);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }
  .reset-btn {
    margin-top: 30px; padding: 10px 20px; 
    background: transparent; border: 1px solid #444; border-radius: 20px;
    color: #666; font-size: 0.8rem;
  }

  /* æºã‚Œã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
  .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
  @keyframes shake { 10%, 90% { transform: translateX(-4px); } 20%, 80% { transform: translateX(4px); } }

</style>
</head>
<body>

<audio id="bgm" loop></audio>
<div id="appScreen">
  <div id="feverEffect"></div>

  <div id="comboContainer">
    <div id="comboNum">3</div>
    <div id="comboLabel">COMBO!</div>
  </div>

  <div id="timerContainer"><div id="timerBar"></div></div>

  <div class="header">
    <div style="display:flex; align-items:center; gap:10px;">
      <div class="home-btn" onclick="backToTitle()">ğŸ </div>
      <div class="level-box" id="devVal">Lv.50.0</div>
    </div>
    <div style="font-size:1.5rem; cursor:pointer;" onclick="toggleMute()" id="muteBtn">ğŸ”Š</div>
  </div>

  <div id="cardContainer">
    </div>

  <div id="expOverlay">
    <div id="expResult" class="exp-result"></div>
    <div class="exp-content-body" id="expBody"></div>
    <div class="swipe-hint">Swipe UP for Next â¬†</div>
  </div>

  <div id="startScreen">
    <div class="title-logo">GAP<br>STUDY</div>
    <div style="color:#666; font-size:0.9rem; margin-bottom:40px; letter-spacing:2px;">TIKTOK STYLE ENGLISH</div>
    
    <button class="btn" onclick="startDiagnosis()" style="background:linear-gradient(45deg, #ff0055, #ff5e00); width:80%; margin-bottom:20px; border:none; box-shadow:0 0 15px rgba(255,0,85,0.4);">
      ğŸ”¥ LEVEL CHECK
    </button>
    <button class="btn" onclick="startGame()" style="background:linear-gradient(45deg, #00f2ea, #0080ff); width:80%; border:none; box-shadow:0 0 15px rgba(0,242,234,0.4);">
      â–¶ GAME START
    </button>
    
    <button class="reset-btn" onclick="confirmReset()">RESET DATA</button>
  </div>
</div>

<script>
  // ==========================================
  //  ãƒ‡ãƒ¼ã‚¿ãƒ»å¤‰æ•°å®šç¾©
  // ==========================================
  // å•é¡Œãƒ‡ãƒ¼ã‚¿ã¯åŒã˜ã‚‚ã®ã‚’ä½¿ç”¨
  const diagnosisQuestions = [
    { q: "éƒ¨æ´»ã®å…ˆè¼©ã¯ã€æ”¾èª²å¾Œã„ã¤ã‚‚ã‚µãƒƒã‚«ãƒ¼ã‚’ç·´ç¿’ã—ã¾ã™ã€‚\nThe senior [     ] soccer after school every day.", opts: ["play", "plays", "playing", "played"], ans: 1, mean: "å…ˆè¼©ã¯æ”¾èª²å¾Œã‚µãƒƒã‚«ãƒ¼ã‚’ã™ã‚‹ã€‚", msg: "ã¾ã‚ã€ã“ã‚Œãã‚‰ã„ã¯å¸¸è­˜ã ã‚ˆã­ã€‚ğŸ˜", rule: "ä¸‰å˜ç¾ã®s" },
    { q: "æ¬¡ã®è©¦åˆã¯æ—¥æ›œæ—¥ã®æœ9æ™‚ã«å§‹ã¾ã‚Šã¾ã™ã€‚\nThe next game starts [     ] 9:00 a.m. on Sunday.", opts: ["on", "in", "at", "to"], ans: 2, mean: "è©¦åˆã¯9æ™‚ã«å§‹ã¾ã‚‹ã€‚", msg: "ã‚ˆã—OKã€‚é…åˆ»å³ç¦ã€‚", rule: "æ™‚åˆ»ã®at" },
    { q: "å¤åˆå®¿ã‚’æ¥½ã—ã¿ã«ã—ã¦ã„ã¾ã™ã€‚\nI look forward to [     ] the summer camp.", opts: ["join", "joining", "joined", "to join"], ans: 1, mean: "å‚åŠ ã‚’æ¥½ã—ã¿ã«ã™ã‚‹ã€‚", msg: "toã®å¾Œã‚ã¯ingã€‚åŸºæœ¬ã€‚", rule: "look forward to ~ing" }
  ];

  const vocabQuestions = [
    { type: "vocab", word: "Postpone", q: "ã€Œå»¶æœŸã™ã‚‹ã€ã€‚ãŠé¢¨å‘‚å…¥ã‚‹ã®ã‚ã‚“ã©ã„â€¦ã€‚", opts: ["Cancel", "Postpone", "Stop", "Repeat"], ans: 1, mean: "å»¶æœŸã™ã‚‹", exp: "é™ç•Œã ã‹ã‚‰ postpone ã•ã›ã¦â€¦zzz" },
    { type: "vocab", word: "Consensus", q: "ã€Œåˆæ„ã€ã€‚ãƒ•ã‚¡ãƒŸãƒ¬ã‚¹ã©ã“è¡Œãï¼Ÿ", opts: ["Compromise", "Consensus", "Contract", "Contact"], ans: 1, mean: "åˆæ„", exp: "èª°ã‹æ—©ã Consensus å–ã£ã¦ãã¦â€¦è…¹æ¸›ã£ãŸ" },
    { type: "vocab", word: "Agenda", q: "ã€Œè­°é¡Œã€ã€‚æ—¥æ›œã®ãƒ‡ãƒ¼ãƒˆã«ã“ã‚Œã¯ä¸è¦ã€‚", opts: ["Minutes", "Agenda", "Schedule", "Topic"], ans: 1, mean: "è­°é¡Œ", exp: "ãƒãƒ¼ãƒ—ãƒ©ãƒ³ã§å¯ã‹ã›ã¦ã‚ˆâ€¦" }
  ];

  // å¤‰æ•°
  let currentQuestions = [];
  let currentIndex = 0;
  let devValue = parseFloat(localStorage.getItem('myDevValue')) || 50.0;
  let combo = 0;
  let isAnswering = false; // å›ç­”ä¸­ã¯æ“ä½œãƒ­ãƒƒã‚¯

  // ã‚¹ãƒ¯ã‚¤ãƒ—åˆ¤å®šç”¨
  let touchStartY = 0;
  let touchEndY = 0;

  // ==========================================
  //  èµ·å‹•ãƒ»åˆæœŸåŒ–
  // ==========================================
  function prepareAudio() { /* ç©ºé–¢æ•°ï¼ˆã‚¨ãƒ©ãƒ¼é˜²æ­¢ï¼‰ */ }

  function playBGM() {
    const bgm = document.getElementById('bgm');
    const track = Math.floor(Math.random() * 3) + 1;
    bgm.src = track + ".mp3";
    bgm.load();
    bgm.oncanplay = function() {
      bgm.volume = 0.3; bgm.muted = false;
      bgm.play().catch(e=>console.log(e));
      bgm.oncanplay = null;
      document.getElementById('muteBtn').innerText = "ğŸ”Š";
    };
  }

  function startDiagnosis() {
    setupGame(diagnosisQuestions, 'diagnosis');
  }

  function startGame() {
    // ãƒ©ãƒ³ãƒ€ãƒ ã«ä¸¦ã³æ›¿ãˆ
    let q = [...vocabQuestions, ...vocabQuestions]; // æ•°ã‚’å¢—ã‚„ã™ãŸã‚2å€ã«
    q.sort(() => Math.random() - 0.5);
    setupGame(q, 'normal');
  }

  function setupGame(list, mode) {
    document.getElementById('startScreen').style.display = 'none';
    playBGM();
    currentQuestions = list;
    currentIndex = 0;
    combo = 0;
    createCard(currentIndex); // æœ€åˆã®ã‚«ãƒ¼ãƒ‰ã‚’ä½œæˆ
    updateStats();
  }

  function backToTitle() {
    document.getElementById('bgm').pause();
    document.getElementById('startScreen').style.display = 'flex';
    document.getElementById('cardContainer').innerHTML = ""; // ã‚«ãƒ¼ãƒ‰æ¶ˆå»
    document.getElementById('expOverlay').classList.remove('show');
  }

  // ==========================================
  //  ã‚«ãƒ¼ãƒ‰ç”Ÿæˆãƒ»ã‚¹ãƒ¯ã‚¤ãƒ—åˆ¶å¾¡
  // ==========================================
  
  // æŒ‡å®šã—ãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®å•é¡Œã‚«ãƒ¼ãƒ‰ã‚’HTMLã«æç”»
  function createCard(index) {
    const container = document.getElementById('cardContainer');
    container.innerHTML = ""; // ä¸€æ—¦ã‚¯ãƒªã‚¢

    if(index >= currentQuestions.length) {
      // å•é¡Œåˆ‡ã‚Œï¼ˆãƒ«ãƒ¼ãƒ—ã•ã›ã‚‹ã‹çµ‚äº†ï¼‰
      alert("All Questions Done! Refreshing...");
      backToTitle();
      return;
    }

    const q = currentQuestions[index];
    const card = document.createElement('div');
    card.className = "quiz-card card-active"; // æœ€åˆã¯è¡¨ç¤ºçŠ¶æ…‹
    
    // ä¸­èº«ã®ç”Ÿæˆ
    let html = "";
    if(q.word) { // å˜èªå•é¡Œ
       html += `<h2 class="word-title">${q.word}</h2>`;
    } else {
       html += `<div style="height:30px;"></div>`;
    }
    
    html += `<div class="question-box">${q.q.replace(/\n/g, '<br>')}</div>`;
    html += `<div class="btn-group">`;
    q.opts.forEach((opt, i) => {
      html += `<button class="btn" onclick="checkAnswer(${i}, this)">${opt}</button>`;
    });
    html += `</div>`;

    card.innerHTML = html;
    container.appendChild(card);
    
    // ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²
    card.addEventListener('touchstart', e => { touchStartY = e.changedTouches[0].screenY; });
    card.addEventListener('touchend', e => {
      touchEndY = e.changedTouches[0].screenY;
      handleSwipe();
    });
    
    // è§£èª¬ã‚’éš ã™
    document.getElementById('expOverlay').classList.remove('show');
    isAnswering = false;
  }

  function handleSwipe() {
    const distance = touchStartY - touchEndY;
    // ä¸Šã«50pxä»¥ä¸Šã‚¹ãƒ¯ã‚¤ãƒ— ï¼† å›ç­”æ¸ˆã¿ãªã‚‰æ¬¡ã¸
    // ï¼ˆå›ç­”å‰ã§ã‚‚ã‚¹ã‚­ãƒƒãƒ—ã•ã›ãŸã„å ´åˆã¯ !isAnswering ã‚’å¤–ã™ï¼‰
    if (distance > 50) {
      nextQuestionAnimation();
    }
  }

  function nextQuestionAnimation() {
    const currentCard = document.querySelector('.card-active');
    if(!currentCard) return;

    // 1. ä»Šã®ã‚«ãƒ¼ãƒ‰ã‚’ä¸Šã«é£›ã°ã™
    currentCard.classList.remove('card-active');
    currentCard.classList.add('card-prev');

    // 2. å°‘ã—å¾…ã£ã¦æ¬¡ã®ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
    setTimeout(() => {
      currentIndex++;
      createCard(currentIndex); 
      // æ–°ã—ã„ã‚«ãƒ¼ãƒ‰ã¯ä¸€ç¬ã ã‘ä¸‹ã«ç½®ã„ã¦ã‹ã‚‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ã‚‹ã¨ã‚ˆã‚Šè‰¯ã„ãŒã€
      // ç°¡æ˜“å®Ÿè£…ã¨ã—ã¦ createCard ã§ active çŠ¶æ…‹ã§æç”»ã™ã‚‹ã ã‘ã§ã‚‚ã€Œãƒ‘ãƒƒã€ã¨åˆ‡ã‚Šæ›¿ã‚ã‚‹
    }, 300);
  }

  // ==========================================
  //  åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
  // ==========================================
  function checkAnswer(selectIndex, btn) {
    if(isAnswering) return; // é€£æ‰“é˜²æ­¢
    isAnswering = true;

    const q = currentQuestions[currentIndex];
    const isCorrect = (selectIndex === q.ans);
    
    const overlay = document.getElementById('expOverlay');
    const resDiv = document.getElementById('expResult');
    const bodyDiv = document.getElementById('expBody');

    if(isCorrect) {
      // æ­£è§£
      combo++;
      if(combo >= 2) showCombo(combo);
      devValue += 0.5;
      
      btn.style.background = "#00f2ea"; btn.style.color = "#000";
      resDiv.innerHTML = "âœ¨ CORRECT!"; resDiv.style.color = "#00f2ea";
      bodyDiv.innerHTML = `<div class="exp-msg">${q.mean}</div><div class="exp-msg" style="color:#aaa;">${q.msg || q.exp}</div>`;
      
      // â˜…ã“ã“ãŒTikToké¢¨ï¼šæ­£è§£ã—ãŸã‚‰è‡ªå‹•ã§å°‘ã—å¾…ã£ã¦æ¬¡ã¸è¡Œãï¼Ÿ
      // ã„ã‚„ã€è§£èª¬ã‚’èª­ã¾ã›ãŸã„ã®ã§ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’å‡ºã—ã¦ã€Œã‚¹ãƒ¯ã‚¤ãƒ—å¾…ã¡ã€ã«ã™ã‚‹
      overlay.classList.add('show');
      
    } else {
      // ä¸æ­£è§£
      combo = 0; hideCombo();
      devValue -= 0.5;
      
      btn.classList.add('shake'); btn.style.background = "#ff0055";
      resDiv.innerHTML = "ğŸ˜¢ MISS..."; resDiv.style.color = "#ff0055";
      bodyDiv.innerHTML = `<div class="exp-msg">${q.mean}</div><div class="exp-msg" style="color:#aaa;">æ­£è§£ã¯: ${q.opts[q.ans]}</div>`;
      
      overlay.classList.add('show');
    }
    updateStats();
  }

  // ==========================================
  //  æ¼”å‡ºãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
  // ==========================================
  function showCombo(n) {
    const cBox = document.getElementById('comboContainer');
    document.getElementById('comboNum').innerText = n;
    cBox.style.opacity = "1"; cBox.style.transform = "scale(1.2)";
    setTimeout(()=>cBox.style.transform="scale(1)", 100);
    if(n>=5) document.getElementById('feverEffect').style.opacity = "1";
  }
  function hideCombo() {
    document.getElementById('comboContainer').style.opacity = "0";
    document.getElementById('feverEffect').style.opacity = "0";
  }

  function updateStats() {
    if(devValue > 80) devValue = 80; if(devValue < 30) devValue = 30;
    localStorage.setItem('myDevValue', devValue);
    document.getElementById('devVal').innerText = "Lv." + devValue.toFixed(1);
    document.getElementById('devVal').style.color = (devValue >= 60) ? "#ff0055" : "#00f2ea";
  }

  function toggleMute() {
    const b = document.getElementById('bgm');
    b.muted = !b.muted;
    document.getElementById('muteBtn').innerText = b.muted ? "ğŸ”‡" : "ğŸ”Š";
  }
  
  function confirmReset() {
    if(confirm("ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) {
      localStorage.clear(); location.reload();
    }
  }
</script>
</body>
</html>
