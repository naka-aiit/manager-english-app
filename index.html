<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Manager English v1.0</title>
<style>
  /* === å…¨ä½“ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆã‚¹ãƒãƒ›ã®é«˜ã•ã‚ºãƒ¬å¯¾ç­–ï¼‰ === */
  body {
    background-color: #000;
    color: white;
    font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    /* dvhã‚’ä½¿ã†ã“ã¨ã§ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã®ä¼¸ç¸®ã«å¯¾å¿œ */
    height: 100vh; 
    height: 100dvh; 
    overflow: hidden;
    touch-action: manipulation;
  }

  /* === ã‚¹ãƒãƒ›ç”»é¢æ  === */
  #appScreen {
    width: 100%;
    max-width: 400px;
    height: 100%;
    /* ç¸¦é•·ã‚¹ãƒãƒ›å¯¾å¿œ */
    max-height: 100%; 
    background: radial-gradient(circle at center, #1a1a2e 0%, #000 100%);
    position: relative;
    border: 1px solid #333;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* === FEVERæ¼”å‡º === */
  #feverEffect {
    position: absolute; top:0; left:0; width:100%; height:100%;
    background: linear-gradient(45deg, rgba(255,0,150,0.1), rgba(0,242,234,0.1));
    opacity: 0; pointer-events: none; z-index: 1; transition: opacity 0.3s;
  }

  /* === ã‚¿ã‚¤ãƒ ãƒãƒ¼ === */
  #timerContainer {
    width: 100%; height: 6px; background: #222; position: absolute; top: 0; left: 0; z-index: 100;
  }
  #timerBar {
    width: 100%; height: 100%; background: #00f2ea; transition: width 0.1s linear;
    box-shadow: 0 0 10px #00f2ea;
  }

  /* === ãƒ˜ãƒƒãƒ€ãƒ¼ === */
  .header {
    padding: 15px 20px;
    display: flex; justify-content: space-between; align-items: center;
    z-index: 10; background: rgba(0,0,0,0.2);
    min-height: 50px; /* ã‚¿ãƒƒãƒ—ã—ã‚„ã™ã */
  }
  .header-left { display: flex; align-items: center; gap: 15px; }
  .home-btn { font-size: 1.8rem; cursor: pointer; text-shadow: 0 0 5px #fff; transition: transform 0.1s; }
  .home-btn:active { transform: scale(0.8); }
  
  .level-box {
    font-weight: 900; font-size: 1.2rem; color: #fff; text-shadow: 0 0 10px #00f2ea;
    font-style: italic;
  }

  /* === ã‚³ãƒ³ãƒœè¡¨ç¤º === */
  #comboContainer {
    position: absolute; top: 15%; width: 100%; text-align: center;
    pointer-events: none; z-index: 5;
    opacity: 0; transform: scale(0.5);
    transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
  #comboNum {
    font-size: 4rem; font-weight: 900; color: #ff0055;
    text-shadow: 2px 2px 0 #fff, 0 0 20px #ff0055;
  }
  #comboLabel {
    font-size: 1.2rem; font-weight: bold; color: #fff; letter-spacing: 5px;
  }

  /* === ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ === */
  #quizContent {
    flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center;
    padding: 20px; position: relative; z-index: 10;
  }

  /* === ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ã‚¶ã‚¤ãƒ³ === */
  .word-title {
    font-size: 3rem; font-weight: 800; margin: 0 0 5px 0; text-align: center;
    text-shadow: 0 4px 10px rgba(0,0,0,0.5);
  }
  .question-box {
    font-size: 1.2rem; font-weight: 500; line-height: 1.5; text-align: center;
    margin-bottom: 30px; text-shadow: 0 2px 4px rgba(0,0,0,0.8);
  }

  /* === ãƒœã‚¿ãƒ³ç¾¤ === */
  .btn-group { display: flex; flex-direction: column; gap: 15px; width: 100%; }
  .btn {
    background: rgba(255,255,255,0.08); 
    border: 1px solid rgba(255,255,255,0.2); 
    color: white;
    padding: 18px; border-radius: 12px; font-size: 1.1rem; font-weight: bold;
    cursor: pointer; transition: transform 0.1s, background 0.2s;
    text-align: center; position: relative; overflow: hidden;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
  }
  .btn:active { transform: scale(0.96); }

  /* === é•·æ–‡ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« === */
  #scrollBox {
    width: 100%; height: 350px; overflow-y: hidden; position: relative;
    mask-image: linear-gradient(to bottom, transparent, black 10%, black 90%, transparent);
    background: rgba(0,0,0,0.3); border-radius: 10px;
  }
  .read-para { margin-bottom: 40px; padding: 15px; }
  .en-text { font-size: 1.3rem; line-height: 1.6; font-weight: 500; text-shadow: 0 2px 4px black; }

  /* === è§£èª¬ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ === */
  #expOverlay {
    position: absolute; bottom: 0; left: 0; width: 100%; height: 75%;
    background: rgba(10,10,15,0.98);
    border-top: 3px solid #00f2ea;
    border-radius: 25px 25px 0 0;
    transform: translateY(110%);
    transition: transform 0.3s cubic-bezier(0.19, 1, 0.22, 1);
    display: flex; flex-direction: column; padding: 25px; box-sizing: border-box; z-index: 200;
    box-shadow: 0 -10px 30px rgba(0,0,0,0.8);
  }
  #expOverlay.show { transform: translateY(0); }
  
  #expContent { flex: 1; overflow-y: auto; }
  
  .exp-question-ref {
    font-size: 0.95rem; color: #888; background: rgba(255,255,255,0.05);
    padding: 10px; border-radius: 6px; margin-bottom: 15px; border-left: 2px solid #555;
    font-style: italic;
  }

  .exp-result { font-size: 2rem; font-weight: 900; margin-bottom: 10px; text-align: center; letter-spacing: 2px; }
  .exp-meaning { 
    font-size: 1.1rem; color: #fff; background: rgba(255,255,255,0.1); 
    padding: 10px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; text-align: center;
  }
  .exp-manager { font-size: 0.9rem; color: #888; margin-bottom: 5px; font-weight: bold; }
  .exp-body { color: #ddd; font-size: 1rem; line-height: 1.6; margin-bottom: 15px; }
  .exp-rule { 
    font-size: 0.9rem; color: #00f2ea; border: 1px dashed #00f2ea; 
    padding: 10px; border-radius: 8px; background: rgba(0, 242, 234, 0.05);
  }

  .next-btn {
    margin-top: 15px; background: #00f2ea; color: #000; font-weight: 900;
    text-align: center; padding: 18px; border-radius: 50px; cursor: pointer;
    box-shadow: 0 0 15px #00f2ea; letter-spacing: 2px;
  }

  /* === ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ === */
  #startScreen {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
    background: #000; z-index: 300;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
  }
  .title-logo {
    font-size: 3.5rem; font-weight: 900; color: #fff; font-style: italic;
    letter-spacing: -2px; margin-bottom: 5px;
    background: linear-gradient(to right, #00f2ea, #ff0055);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }
  
  /* ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ï¼šå®‰å…¨åœ°å¸¯ï¼ˆä¸­å¤®å¯„ã‚Šï¼‰ã«é…ç½® */
  .reset-btn {
    margin-top: 30px; /* ãƒœã‚¿ãƒ³åŒå£«ã®é–“éš” */
    margin-bottom: 0; /* ä¸‹ã®ä½™ç™½ã¯ä¸è¦ï¼ˆä¸­å¤®å¯„ã›ãªã®ã§ï¼‰ */
    padding: 12px 25px; 
    background: transparent;
    border: 1px solid #555; border-radius: 20px;
    color: #888; font-size: 0.85rem; cursor: pointer;
    transition: all 0.2s;
    font-family: inherit;
  }
  .reset-btn:active {
    background: #333; color: #fff; transform: scale(0.95);
  }

  .shake { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
  @keyframes shake { 10%, 90% { transform: translateX(-2px); } 20%, 80% { transform: translateX(2px); } }
  
  .mode-badge {
    position: absolute; top: 20px; right: 20px; 
    background: #222; color: #aaa; padding: 5px 10px; 
    border-radius: 4px; font-size: 0.7rem; font-weight: bold; letter-spacing: 1px;
  }

</style>
</head>
<body>

<audio id="bgm" loop></audio>

<div id="appScreen">
  <div id="feverEffect"></div>

  <div id="comboContainer">
    <div id="comboNum">3</div>
    <div id="comboLabel">COMBO!</div>
  </div>

  <div id="timerContainer"><div id="timerBar"></div></div>

  <div class="header">
    <div class="header-left">
      <div class="home-btn" onclick="backToTitle()">ğŸ </div>
      <div class="level-box" id="devVal">Lv.50.0</div>
    </div>
    <div style="font-size:1.5rem; cursor:pointer;" onclick="toggleMute()" id="muteBtn">ğŸ”Š</div>
  </div>

  <div id="quizContent"></div>

  <div id="expOverlay">
    <div id="expContent"></div>
    <div class="next-btn" onclick="nextQuestion()">NEXT</div>
  </div>

  <div id="startScreen">
    <div class="title-logo">GAP<br>STUDY</div>
    <div style="color:#666; font-size:0.9rem; margin-bottom:50px; letter-spacing:2px;">TIKTOK STYLE ENGLISH</div>
    
    <button class="btn" onclick="startDiagnosis()" style="background:linear-gradient(45deg, #ff0055, #ff5e00); width:80%; margin-bottom:20px; border:none;">
      ğŸ”¥ LEVEL CHECK
    </button>
    <button class="btn" onclick="startGame()" style="background:linear-gradient(45deg, #00f2ea, #0080ff); width:80%; border:none;">
      â–¶ GAME START
    </button>
    
    <button class="reset-btn" onclick="resetData()">RESET SAVE DATA</button>
  </div>
</div>

<script>
  // ==========================================
  //  1. ãƒ‡ãƒ¼ã‚¿å®šç¾©
  // ==========================================
  const diagnosisQuestions = [
    { 
      level: 1, difficulty_label: "Lv.40", 
      question: "éƒ¨æ´»ã®å…ˆè¼©ã¯ã€æ”¾èª²å¾Œã„ã¤ã‚‚ã‚µãƒƒã‚«ãƒ¼ã‚’ç·´ç¿’ã—ã¾ã™ã€‚\nThe senior [     ] soccer after school every day.", 
      options: ["play", "plays", "playing", "played"], correct: 1, 
      meaning: "å…ˆè¼©ã¯æ”¾èª²å¾Œã‚µãƒƒã‚«ãƒ¼ã‚’ã™ã‚‹ã€‚", 
      msg_correct: "ã¾ã‚ã€ã“ã‚Œãã‚‰ã„ã¯å¸¸è­˜ã ã‚ˆã­ã€‚ğŸ˜",
      msg_wrong: "ã¯ï¼Ÿ ã“ã‚Œé–“é•ãˆãŸã‚‰ãƒã‚¸ã§ç¾©å‹™æ•™è‚²ã‚„ã‚Šç›´ã—æ¡ˆä»¶ã ã‚ˆï¼ŸğŸ˜¤",
      grammar_rule: "ä¸»èªãŒã€The seniorï¼ˆä¸‰äººç§°å˜æ•°ï¼‰ã€ã ã‹ã‚‰ã€å‹•è©ã«ã€sã€ãŒã¤ãã¾ã™ã€‚"
    },
    { 
      level: 1, difficulty_label: "Lv.40", 
      question: "æ¬¡ã®è©¦åˆã¯æ—¥æ›œæ—¥ã®æœ9æ™‚ã«å§‹ã¾ã‚Šã¾ã™ã€‚\nThe next game starts [     ] 9:00 a.m. on Sunday.", 
      options: ["on", "in", "at", "to"], correct: 2, 
      meaning: "æ¬¡ã®è©¦åˆã¯9æ™‚ã«å§‹ã¾ã‚‹ã€‚", 
      msg_correct: "ã‚ˆã—ã€OKã€‚é…åˆ»ã¯è¨±ã•ãªã„ã‹ã‚‰ã­ã€‚",
      msg_wrong: "é©å½“ã«é¸ã‚“ã ã§ã—ã‚‡ï¼Ÿ æ™‚é–“ã®ä¸€ç‚¹ã¯ at ã—ã‹ãªã„ã®ã€‚",
      grammar_rule: "9:00ã¨ã„ã†ã€ç‚¹ã€ã‚’æŒ‡ã™ã¨ãã¯ at ã‚’ä½¿ã„ã¾ã™ã€‚"
    },
    { 
      level: 2, difficulty_label: "Lv.50", 
      question: "é¡§å•ã®å…ˆç”Ÿã¯ã€éƒ¨å“¡ãŸã¡ãŒç·´ç¿’ä¸­ã«ãŠå–‹ã‚Šã™ã‚‹ã®ã‚’ã‚„ã‚ã•ã›ãŸã€‚\nThe coach told the members to stop [     ] during practice.", 
      options: ["talk", "to talk", "talking", "talked"], correct: 2, 
      meaning: "è©±ã™ã®ã‚’ã‚„ã‚ã‚‹ã€‚", 
      msg_correct: "æ­£è§£ã€‚ç·´ç¿’ä¸­ã¯ç„¡é§„å£ãŸãŸã‹ãªã„ã€‚åŸºæœ¬ã§ã—ã‚‡ï¼Ÿ",
      msg_wrong: "ã€å–‹ã‚‹ãŸã‚ã«ç«‹ã¡æ­¢ã¾ã‚‹ï¼ˆstop toï¼‰ã€ã‚ã‘ãªã„ã˜ã‚ƒã‚“ã€‚æ–‡è„ˆèª­ã‚“ã§ã€‚",
      grammar_rule: "stop ~ing ã¯ã€Œï½ã™ã‚‹ã“ã¨ã‚’ã‚„ã‚ã‚‹ã€ã€‚stop to ~ ã¯ã€Œï½ã™ã‚‹ãŸã‚ã«æ­¢ã¾ã‚‹ã€ã€‚"
    },
    { 
      level: 2, difficulty_label: "Lv.50", 
      question: "å¤åˆå®¿ã‚’æ¥½ã—ã¿ã«ã—ã¦ã„ã¾ã™ã€‚\nI look forward to [     ] the summer training camp.", 
      options: ["join", "joining", "joined", "to join"], correct: 1, 
      meaning: "å‚åŠ ã™ã‚‹ã®ã‚’æ¥½ã—ã¿ã«ã™ã‚‹ã€‚", 
      msg_correct: "ãŠã£ã€å¼•ã£ã‹ã‹ã‚‰ãªã‹ã£ãŸã­ã€‚ã‚„ã‚‹ã˜ã‚ƒã‚“ã€‚",
      msg_wrong: "ã¯ã„å‡ºãŸã€‚ã€toã€ãŒã‚ã‚‹ã‹ã‚‰å‹•è©ã®åŸå½¢ã ã¨æ€ã£ãŸã§ã—ã‚‡ï¼Ÿ ç”˜ã„ã€‚",
      grammar_rule: "ã“ã® to ã¯å‰ç½®è©ãªã®ã§ã€å¾Œã‚ã¯å‹•åè©(ing)ã«ãªã‚Šã¾ã™ã€‚"
    },
    { 
      level: 3, difficulty_label: "Lv.60", 
      question: "ã‚‚ã—ç§ãŒå›ã ã£ãŸã‚‰ã€ãã‚“ãªã‚ã‹ã‚‰ã•ã¾ãªãƒ•ã‚¡ã‚¦ãƒ«ã¯ã—ãªã„ã ã‚ã†ã€‚\nIf I [     ] you, I wouldn't commit such an obvious foul.", 
      options: ["am", "was", "were", "have been"], correct: 2, 
      meaning: "ã‚‚ã—ç§ãŒã‚ãªãŸãªã‚‰ã€‚", 
      msg_correct: "æ­£è§£ã€‚ç¾å®Ÿé€ƒé¿ï¼ˆä»®å®šæ³•ï¼‰ã¯å¾—æ„ã¿ãŸã„ã­ã€‚",
      msg_wrong: "ã‚ãƒ¼ã‚ã€‚ã‚‚ã—ç§ãŒã‚ã‚“ãŸãªã‚‰ï¼ˆIf I were youï¼‰ã€ã‚‚ã£ã¨å‹‰å¼·ã™ã‚‹ã‘ã©ã­ã€‚",
      grammar_rule: "ä»®å®šæ³•éå»ã€‚Ifç¯€ã®ä¸­ã®beå‹•è©ã¯ were ã‚’ä½¿ã†ã®ãŒå®šçŸ³ã§ã™ã€‚"
    },
    { 
      level: 3, difficulty_label: "Lv.60", 
      question: "å½¼ã«ä½œæˆ¦ä¼šè­°ã«å‡ºå¸­ã™ã‚‹ã‚ˆã†ææ¡ˆã—ãŸã€‚\nI suggested that he [     ] the strategy meeting.", 
      options: ["attends", "attended", "attend", "attending"], correct: 2, 
      meaning: "å‡ºå¸­ã™ã‚‹ã‚ˆã†ã«ææ¡ˆã—ãŸã€‚", 
      msg_correct: "ã“ã‚Œè§£ã‘ã‚‹ã®ï¼Ÿ æ„å¤–ã¨åå·®å€¤ã‚ã‚‹ã‹ã‚‚ã­ã€‚",
      msg_wrong: "he ã ã‹ã‚‰ attends ã«ã—ãŸã§ã—ã‚‡ï¼Ÿ ãã®ç´ ç›´ã•ãŒå‘½å–ã‚Šã€‚",
      grammar_rule: "suggestï¼ˆææ¡ˆï¼‰ã®å¾Œã‚ã®thatç¯€ã«ã¯ should ãŒéš ã‚Œã¦ã„ã‚‹ãŸã‚ã€å‹•è©ã¯åŸå½¢ã«ãªã‚Šã¾ã™ã€‚"
    }
  ];

  const vocabQuestions = [
    { type: "vocab", word: "Postpone", phonetic: "/pÉ™ÊŠËˆspÉ™ÊŠn/", question: "ã€Œå»¶æœŸã™ã‚‹ã€ã€‚ä»Šã®ç§ã«ä¸€ç•ªå¿…è¦ãªè¨€è‘‰ã€‚", options: ["Cancel", "Postpone", "Stop", "Repeat"], correct: 1, meaning: "å»¶æœŸã™ã‚‹ã€å¾Œå›ã—ã«ã™ã‚‹", exp: "ã€OFFğŸ’¤ã€‘ã‚€ã‚Šâ€¦ã€‚å‹•ã‘ãªã„â€¦ã€‚ãŠé¢¨å‘‚å…¥ã‚‰ãªãã‚ƒã ã‘ã©ã€é™ç•Œã ã‹ã‚‰ postponeï¼ˆå»¶æœŸï¼‰ã•ã›ã¦â€¦ã€‚ã€postï¼ˆå¾Œã‚ã«ï¼‰ã€ã€poneï¼ˆç½®ãï¼‰ã€ã£ã¦æ„å‘³ã€‚ä»Šã®å…¥æµ´ postpone ã¯ç”Ÿå­˜æˆ¦ç•¥ã ã‹ã‚‰â€¦zzzã€‚" },
    { type: "vocab", word: "Consensus", phonetic: "/kÉ™nËˆsensÉ™s/", question: "ã€Œåˆæ„ã€ã€‚ã¿ã‚“ãªãŒã„ã„ã‚ˆã£ã¦è¨€ã†ã“ã¨ã€‚", options: ["Compromise", "Consensus", "Contract", "Contact"], correct: 1, meaning: "åˆæ„ã€æ„è¦‹ã®ä¸€è‡´", exp: "ã€OFFğŸ·ã€‘é£²ã¿ä¼šã®åº—æ±ºã‚ã§1æ™‚é–“LINEã—ã¦ã‚‹ã®ä½•ï¼Ÿ ã€conï¼ˆå…±ã«ï¼‰ã€ã€sensusï¼ˆæ„Ÿã˜ã‚‹ï¼‰ã€ã€‚ã‚‚ã†ã‚µã‚¤ã‚¼ã§ã‚ˆããªã„ï¼Ÿ èª°ã‹æ—©ã consensus å–ã£ã¦ãã¦â€¦ãŠè…¹ã™ã„ã¦æ­»ã¬ã€‚" },
    { type: "vocab", word: "Agenda", phonetic: "/É™ËˆdÊ’endÉ™/", question: "ã€Œè­°é¡Œã€ã€‚ã“ã‚ŒãŒãªã„ä¼šè­°ã¯åœ°ç„ã€‚", options: ["Minutes", "Agenda", "Schedule", "Topic"], correct: 1, meaning: "è­°é¡Œã€äºˆå®šè¡¨", exp: "ã€OFFğŸ®ã€‘ä¼‘æ—¥ã®ãƒ‡ãƒ¼ãƒˆã« Agenda æŒã£ã¦ãã‚‹å½¼æ°ã¯ç„¡ç†ã€‚ä»•äº‹ä¸­ã¯å¤§äº‹ã ã‘ã©ã€æ—¥æ›œã®æœãã‚‰ã„ãƒãƒ¼ãƒ—ãƒ©ãƒ³ã§å¯ã‹ã›ã¦ã‚ˆâ€¦ã€‚" }
  ];

  const grammarQuestions = [
    { type: "grammar_judgment", question: "I will tell him the truth when he will come home.", is_correct: false, focus: "æ™‚ãƒ»æ¡ä»¶ã®å‰¯è©ç¯€", meaning: "å½¼ãŒå¸°ã£ã¦ããŸã‚‰çœŸå®Ÿã‚’è©±ã™ã¤ã‚‚ã‚Šã ã€‚", explanation: "ã€OFFğŸ™…â€â™€ï¸ã€‘ã†ã£ã‚ã€ãƒ€ã‚µã£ï¼ã€å½¼ãŒå¸°ã£ã¦ãã‚‹ã€ã®ã¯æœªæ¥ã ã‘ã©ã€whenï¼ˆæ™‚ã‚’è¡¨ã™å‰¯è©ç¯€ï¼‰ã®ä¸­ã§ã¯æœªæ¥ã®ã“ã¨ã‚‚ã€ç¾åœ¨å½¢ã€ã§æ›¸ãã®ãŒãƒ«ãƒ¼ãƒ«ãªã®ã€‚will 2å›ã‚‚ä½¿ã£ã¦ã€ã—ã¤ã“ã„ç”·ã¿ãŸã„ã«ãªã£ã¦ã‚“ã˜ã‚ƒã‚“ã€‚" },
    { type: "grammar_judgment", question: "My father objected to buy a new car.", is_correct: false, focus: "ä¸å®šè©ãƒ»å‹•åè©", meaning: "çˆ¶ã¯æ–°è»Šã®è³¼å…¥ã«åå¯¾ã—ãŸã€‚", explanation: "ã€OFFğŸ™…â€â™€ï¸ã€‘ã¯ã„ã€å¼•ã£ã‹ã‹ã£ãŸãƒ¼ã€‚object to ã®ã€toã€ã¯ã€ï½ã«å¯¾ã—ã¦ã€ã£ã¦ã„ã†å‰ç½®è©ãªã®ï¼ å‰ç½®è©ã®å¾Œã‚ã¯åè©ï¼ˆå‹•åè©ï¼‰ã£ã¦æ±ºã¾ã£ã¦ã‚“ã®ï¼ buying ã«ç›´ã—ãªã•ã„ã€‚" },
    { type: "grammar_judgment", question: "Had I known the truth, I would have told you.", is_correct: true, focus: "ä»®å®šæ³•éå»å®Œäº†", meaning: "çœŸå®Ÿã‚’çŸ¥ã£ã¦ã„ãŸã‚‰å›ã«è©±ã—ã¦ã„ãŸã ã‚ã†ã«ã€‚", explanation: "ã€OFFğŸ™†â€â™€ï¸ã€‘ãŠã€æ­£è§£ã€‚ã“ã‚Œã€If I had known...ã€ã® If ãŒçœç•¥ã•ã‚Œã¦ã€ç–‘å•æ–‡ã¿ãŸã„ã«ã²ã£ãã‚Šè¿”ã£ã¦ã‚‹ï¼ˆå€’ç½®ï¼‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã­ã€‚ã„ããªã‚Š Had ã‹ã‚‰å§‹ã¾ã£ã¦ã‚‚ãƒ“ãƒ“ã‚‰ãªã„ãƒ¡ãƒ³ã‚¿ãƒ«å¤§äº‹ã€‚" }
  ];

  const readingQuestions = [
    {
      type: "reading_scroll",
      title: "Unread Message",
      bpm: 30,
      full_jp: "æ˜¨æ—¥ã€æ†§ã‚Œã®ã‚­ãƒ£ãƒ—ãƒ†ãƒ³ã«LINEã—ãŸã€‚ã€Œæ¬¡ã®è©¦åˆã„ã¤ã§ã™ã‹ï¼Ÿã€ã£ã¦ã€‚ã§ã‚‚æœ¬å½“ã¯æ¥­å‹™é€£çµ¡ã˜ã‚ƒãªãã¦120%ã‹ã¾ã£ã¦ã‚¢ãƒ”ãƒ¼ãƒ«ã€‚ãªã®ã«24æ™‚é–“è¿”ä¿¡ãªã—ï¼ä¼‘æ†©ä¸­ã¯ã„ã¤ã‚‚ã‚¹ãƒãƒ›è¦‹ã¦ã‚‹ãã›ã«ã€‚ä¸å®‰ã™ãã¦ã€Œç§ã€å¤‰ãªã‚¹ãƒãƒ‰ãƒªæ¸¡ã—ãŸï¼Ÿã€ã¨ã‹è€ƒãˆã¡ã‚ƒã£ãŸã€‚<br><br>ä»Šæ—¥ã®éƒ¨æ´»ã€æ€–ãã¦ç›®ã‚‚åˆã‚ã›ã‚‰ã‚Œãªã‹ã£ãŸã€‚ãã—ãŸã‚‰çªç„¶å…ˆè¼©ãŒçœŸé¡”ã§è¿‘ã¥ã„ã¦ãã¦ä¸€è¨€ã€‚ã€Œã‚ã‚Šãƒã€è¿”ä¿¡é…ã‚Œã¦ã€‚æ˜¨æ—¥ã‚¹ãƒãƒ›ã‚’ãƒˆã‚¤ãƒ¬ã«è½ã¨ã—ã¦æ°´æ²¡ã—ãŸã‚ã€ã€‚â€¦â€¦ã¯ï¼Ÿ ãƒˆã‚¤ãƒ¬ï¼Ÿ ç”·å­ã¯è¤‡é›‘ãªç”Ÿãç‰©ã‹ã¨æ€ã£ãŸã‘ã©ã€ãŸã ã®ã‚¢ãƒ›ã ã£ãŸã€‚ç§ã®ãƒ‰ã‚­ãƒ‰ã‚­è¿”ã—ã¦ã€‚",
      paragraphs: [
        { en: "I sent a message to the captain yesterday, asking about the schedule for the next match." },
        { en: "However, he hasn't replied to me yet. It has been more than 24 hours!" },
        { en: "Since he usually checks his phone during breaks, I felt extremely anxious." },
        { en: "I started wondering if I had done something rude." },
        { en: "Today at practice, I tried to avoid eye contact out of fear." },
        { en: "But suddenly, he walked straight up to me with a serious look on his face." },
        { en: "He scratched his head and said, \"Sorry for the late reply. I dropped my phone in the toilet yesterday.\"" },
        { en: "I was relieved but also exhausted. Boys are just simple and clumsy." }
      ]
    }
  ];

  // ==========================================
  //  2. ã‚·ã‚¹ãƒ†ãƒ å¤‰æ•°
  // ==========================================
  let feedQuestions = [];
  let currentQ = 0; 
  let currentMode = 'normal'; 
  let devValue = parseFloat(localStorage.getItem('myDevValue')) || 50.0;
  let diagnosisScore = 0;
  let scrollInterval = null;
  let timerInterval = null;
  let timeLeft = 100;
  let combo = 0;

  // ==========================================
  //  3. ã‚²ãƒ¼ãƒ é–‹å§‹ãƒ•ãƒ­ãƒ¼
  // ==========================================
  
  function startDiagnosis() {
    document.getElementById('startScreen').style.display = 'none';
    currentMode = 'diagnosis';
    currentQ = 0;
    diagnosisScore = 0;
    combo = 0;
    playBGM();
    loadQuestion();
  }

  function startGame() {
    document.getElementById('startScreen').style.display = 'none';
    currentMode = 'normal';
    feedQuestions = [...vocabQuestions, ...grammarQuestions, ...readingQuestions];
    feedQuestions.sort(() => Math.random() - 0.5);
    currentQ = 0;
    combo = 0;
    playBGM();
    loadQuestion();
    updateStats();
  }

  function backToTitle() {
    clearInterval(timerInterval);
    if(scrollInterval) clearInterval(scrollInterval);
    
    // BGMåœæ­¢
    const bgm = document.getElementById('bgm');
    bgm.pause();
    bgm.currentTime = 0;

    combo = 0;
    document.getElementById('feverEffect').style.opacity = "0";
    document.getElementById('comboContainer').style.opacity = "0";
    document.getElementById('expOverlay').classList.remove('show');
    document.getElementById('startScreen').style.display = 'flex';
  }

  function playBGM() {
    const bgm = document.getElementById('bgm');
    const track = Math.floor(Math.random() * 10) + 1; 
    
    if(bgm.paused) {
      bgm.src = track + ".mp3";
      bgm.volume = 0.3;
      bgm.muted = false; 
      bgm.play().catch(e => console.log("Auto-play blocked"));
      document.getElementById('muteBtn').innerText = "ğŸ”Š";
    }
  }

  // ==========================================
  //  4. å•é¡Œè¡¨ç¤º & ã‚¿ã‚¤ãƒãƒ¼
  // ==========================================
  function loadQuestion() {
    resetTimer(); 
    if(scrollInterval) clearInterval(scrollInterval);
    hideCombo(); 

    let q;
    let titleText = "";
    let badgeText = ""; 
    let contentHtml = "";

    if (currentMode === 'diagnosis') {
      if (currentQ >= diagnosisQuestions.length) { finishDiagnosis(); return; }
      q = diagnosisQuestions[currentQ];
      titleText = q.difficulty_label;
      badgeText = "LEVEL CHECK"; 
      contentHtml = `
        <div class="question-box">${q.question.replace(/\n/g, '<br>')}</div>
        <div class="btn-group">
          ${q.options.map((opt, i) => `<button class="btn" onclick="checkDiagnosis(${i}, this)">${i+1}. ${opt}</button>`).join('')}
        </div>`;
    } else {
      if (currentQ >= feedQuestions.length) { feedQuestions.sort(() => Math.random() - 0.5); currentQ = 0; }
      q = feedQuestions[currentQ];

      if (q.type === 'vocab') {
        titleText = "???"; 
        badgeText = "Vocab";
        contentHtml = `
          <div class="question-box">${q.question.replace(/\n/g, '<br>')}</div>
          <div class="btn-group">
            ${q.options.map((opt, i) => `<button class="btn" onclick="checkVocab(${i}, this)">${i+1}. ${opt}</button>`).join('')}
          </div>`;
          startTimer(10);

      } else if (q.type === 'grammar_judgment') {
        titleText = "Judge!";
        badgeText = "Grammar";
        contentHtml = `
          <div class="question-box">${q.question.replace(/\n/g, '<br>')}</div>
          <div class="btn-group" style="flex-direction:row;">
            <button class="btn" onclick="checkGrammar(true, this)" style="flex:1; border-color:#00f2ea; color:#00f2ea;">ğŸ™†â€â™€ï¸ True</button>
            <button class="btn" onclick="checkGrammar(false, this)" style="flex:1; border-color:#ff0055; color:#ff0055;">ğŸ™…â€â™€ï¸ False</button>
          </div>`;
          startTimer(8);

      } else if (q.type === 'reading_scroll') {
        titleText = "Read!";
        badgeText = "Reading";
        const paragraphsHtml = q.paragraphs.map((p, i) => 
          `<div class="read-para"><div class="en-text">${p.en}</div></div>`
        ).join('');
        contentHtml = `
          <div id="scrollBox">
            ${paragraphsHtml}
            <div style="height:150px;"></div>
          </div>
          <button class="btn" onclick="finishReading()" style="background:#00f2ea; color:#000; text-align:center; margin-top:10px;">I Read It! (è§£èª¬)</button>
        `;
      }
    }

    const html = `
      <div class="mode-badge">${badgeText}</div>
      <h2 class="word-title">${titleText}</h2>
      ${contentHtml}
    `;
    document.getElementById('quizContent').innerHTML = html;

    if(currentMode === 'normal' && q.type === 'reading_scroll') {
      startAutoScroll();
    }
  }

  function startTimer(seconds) {
    const bar = document.getElementById('timerBar');
    timeLeft = 100;
    bar.style.width = "100%";
    bar.style.backgroundColor = "#00f2ea";
    bar.style.boxShadow = "0 0 10px #00f2ea";

    const step = 100 / (seconds * 10);
    timerInterval = setInterval(() => {
      timeLeft -= step;
      bar.style.width = timeLeft + "%";
      if(timeLeft < 30) {
        bar.style.backgroundColor = "#ff0055"; 
        bar.style.boxShadow = "0 0 10px #ff0055";
      }
      if(timeLeft <= 0) {
        clearInterval(timerInterval);
        timeUp();
      }
    }, 100);
  }

  function resetTimer() {
    clearInterval(timerInterval);
    document.getElementById('timerBar').style.width = "0%";
  }

  function timeUp() {
    combo = 0; 
    const q = (currentMode === 'diagnosis') ? diagnosisQuestions[currentQ] : feedQuestions[currentQ];
    
    showOverlay(
      `<div class="exp-result" style="color:#ff0055;">â° TIME UP!</div>
       <div class="exp-question-ref">Q. ${q.question.replace(/\n/g, ' ')}</div>
       <div class="exp-body">é…ã„ï¼åˆ¤æ–­é…ã„ï¼</div>`, false
    );
    if(currentMode !== 'diagnosis') { devValue -= 1.0; updateStats(); }
  }

  // ==========================================
  //  5. åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
  // ==========================================
  
  function addCombo() {
    combo++;
    if(combo >= 2) {
      const cBox = document.getElementById('comboContainer');
      const cNum = document.getElementById('comboNum');
      cNum.innerText = combo;
      cBox.style.opacity = "1";
      cBox.style.transform = "scale(1.2)";
      setTimeout(() => { cBox.style.transform = "scale(1)"; }, 100);
      
      if(combo >= 5) document.getElementById('feverEffect').style.opacity = "1";
    }
  }

  function hideCombo() {
    document.getElementById('comboContainer').style.opacity = "0";
  }

  function checkDiagnosis(selectIndex, btnElement) {
    const q = diagnosisQuestions[currentQ];
    const isCorrect = (selectIndex === q.correct);
    
    if(isCorrect) {
      btnElement.style.background = "#ff0055"; 
      showOverlay(
        `<div class="exp-result" style="color:#00f2ea;">âœ¨ CORRECT!</div>
         <div class="exp-question-ref">Q. ${q.question.replace(/\n/g, ' ')}</div>
         <div class="exp-meaning">${q.meaning}</div>
         <div class="exp-manager">ğŸ’¡ Manager's:</div>
         <div class="exp-body">${q.msg_correct}</div>
         <div class="exp-rule">ğŸ“ Rule:<br>${q.grammar_rule}</div>`
      );
    } else {
      btnElement.classList.add('shake'); 
      showOverlay(
        `<div class="exp-result" style="color:#ff0055;">ğŸ˜¢ MISS...</div>
         <div class="exp-question-ref">Q. ${q.question.replace(/\n/g, ' ')}</div>
         <div class="exp-meaning">${q.meaning}</div>
         <div class="exp-manager">ğŸ’¡ Manager's:</div>
         <div class="exp-body">${q.msg_wrong}</div>
         <div class="exp-rule">ğŸ“ Rule:<br>${q.grammar_rule}</div>`
      );
    }
  }

  function checkVocab(selectIndex, btnElement) {
    clearInterval(timerInterval);
    const q = feedQuestions[currentQ];
    const isCorrect = (selectIndex === q.correct);
    document.querySelector('.word-title').innerText = q.word;

    if(isCorrect) {
      addCombo();
      devValue += 0.5; updateStats();
      btnElement.style.background = "#00f2ea"; btnElement.style.color = "#000";
      showOverlay(`
        <div class="exp-result" style="color:#00f2ea;">âœ¨ CORRECT!</div>
        <div class="exp-question-ref">Q. ${q.question.replace(/\n/g, ' ')}</div>
        <div class="exp-meaning">${q.meaning}</div>
        <div class="exp-manager">ğŸ’¡ Manager's:</div>
        <div class="exp-body">${q.exp}</div>
      `);
    } else {
      combo = 0; document.getElementById('feverEffect').style.opacity = "0";
      devValue -= 0.5; updateStats();
      btnElement.classList.add('shake');
      showOverlay(`
        <div class="exp-result" style="color:#ff0055;">ğŸ˜¢ MISS...</div>
        <div class="exp-question-ref">Q. ${q.question.replace(/\n/g, ' ')}</div>
        <div class="exp-meaning">${q.meaning}</div>
        <div class="exp-manager">ğŸ’¡ Manager's:</div>
        <div class="exp-body">${q.exp}</div>
      `);
    }
  }

  function checkGrammar(userAnswer, btnElement) {
    clearInterval(timerInterval);
    const q = feedQuestions[currentQ];
    const isCorrect = (userAnswer === q.is_correct);

    if(isCorrect) {
      addCombo();
      devValue += 1.0; updateStats();
      btnElement.style.background = userAnswer ? "#00f2ea" : "#ff0055"; btnElement.style.color = "#fff";
      showOverlay(`
        <div class="exp-result" style="color:#00f2ea;">âœ¨ GREAT EYE!</div>
        <div class="exp-question-ref">Q. ${q.question.replace(/\n/g, ' ')}</div>
        <div class="exp-meaning">${q.meaning}</div>
        <div class="exp-manager">ğŸ’¡ Point:</div>
        <div class="exp-body">${q.explanation}</div>
      `);
    } else {
      combo = 0; document.getElementById('feverEffect').style.opacity = "0";
      devValue -= 1.0; updateStats();
      btnElement.classList.add('shake');
      showOverlay(`
        <div class="exp-result" style="color:#ff0055;">ğŸ˜¢ OOPS...</div>
        <div class="exp-question-ref">Q. ${q.question.replace(/\n/g, ' ')}</div>
        <div class="exp-meaning">${q.meaning}</div>
        <div class="exp-manager">ğŸ’¡ Point:</div>
        <div class="exp-body">${q.explanation}</div>
      `);
    }
  }

  function startAutoScroll() {
    const box = document.getElementById('scrollBox');
    let speed = 1; if(devValue > 60) speed = 1.5;
    scrollInterval = setInterval(() => {
      if(box.scrollTop + box.clientHeight >= box.scrollHeight) clearInterval(scrollInterval);
      else box.scrollTop += speed;
    }, 50);
  }

  function finishReading() {
    if(scrollInterval) clearInterval(scrollInterval);
    const q = feedQuestions[currentQ];
    devValue += 2.0; updateStats();
    
    showOverlay(`
      <div class="exp-result" style="color:#00f2ea;">ğŸ“š COMPLETE!</div>
      <div class="exp-meaning">${q.title}</div>
      <div class="exp-manager">ğŸ“ ã‚ã‚‰ã™ã˜ï¼†å…¨è¨³:</div>
      <div style="font-size:0.95rem; color:#ffab91; line-height:1.8;">${q.full_jp}</div>
    `);
  }

  // ==========================================
  //  å…±é€šå‡¦ç†
  // ==========================================
  function showOverlay(html) {
    document.getElementById('expContent').innerHTML = html;
    document.getElementById('expOverlay').classList.add('show');
  }

  function nextQuestion() {
    document.getElementById('expOverlay').classList.remove('show');
    currentQ++;
    setTimeout(() => { loadQuestion(); }, 200);
  }

  function updateStats() {
    if(devValue > 80) devValue = 80; if(devValue < 30) devValue = 30;
    localStorage.setItem('myDevValue', devValue);
    document.getElementById('devVal').innerText = "Lv." + devValue.toFixed(1);
    document.getElementById('devVal').style.color = (devValue >= 60) ? "#ff0055" : "#00f2ea";
  }

  function finishDiagnosis() {
    let d = 30;
    if(diagnosisScore>=1) d=35; if(diagnosisScore>=3) d=45; if(diagnosisScore>=5) d=55; if(diagnosisScore==6) d=60;
    devValue = d; localStorage.setItem('myDevValue', devValue);
    alert(`è¨ºæ–­çµ‚äº†ï¼åå·®å€¤${devValue}ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆï¼`);
    backToTitle(); 
    updateStats();
  }

  function toggleMute() {
    const b = document.getElementById('bgm');
    const btn = document.getElementById('muteBtn');
    if(b.muted) { b.muted = false; btn.innerText = "ğŸ”Š"; }
    else { b.muted = true; btn.innerText = "ğŸ”‡"; }
  }

  function resetData() {
    if(confirm("ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) { localStorage.removeItem('myDevValue'); location.reload(); }
  }
</script>
</body>
</html>
